syms s t;

A = [[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0];
[0 , -0.0021818182 , 0 , 0 , 0 , 0 , 0 , 0 , -1.0734E-5 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.0021818182];
[0 , 0.0021818182 , -0.0021818182 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , -1.0734E-5 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0];
[0 , 0 , 0 , -0.228 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.008 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.22 , 0];
[0 , 0 , 0 , 0 , -0.0021818182 , 0 , -1.0734E-5 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.0021818182 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0];
[0 , 0 , 0 , 0 , -3.4651156E-14 , 0 , -0.049685834 , -0.00057379064 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.049707483 , 0 , 0 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , -0.0051818182 , 0 , 0.0021818182 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.003 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , -0.047964462 , 0 , 0 , 0 , -0.00057379064 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.047986111 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , -0.0051818182 , 0 , 0 , 0.0021818182 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.003 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.037235904 , 0 , 0.037235781 , 0 , -0.16810037 , 0.037235659 , 0 , 0 , 0 , 0.0191806 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.037235537 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , -0.0051818182 , 0.003 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.0021818182 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.22 , -0.228 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.008 , 0 , 0 , 0 , 0 , 0 , 0 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , -0.0005359628 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 7.77E-5 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.0004582628 , -0.0005359628 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 7.77E-5 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 7.77E-5 , 0 , 0 , 0 , 0.0004582628 , -0.0005359628 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , -0.0004582628 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , -1.0734E-5 , 0 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.0004582628 , -0.0004582628 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , -1.0734E-5 , 0 , 0 , 0 , 0 , 0 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.0004582628 , -0.0004582628 , -1.0734E-5 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0.027527778 , 0.0030584608 , 0.027527778 , 0.030588727 , 0 , -0.016197935 , 0.0030584608 , 0 , 0 , 0 , 0 , 0 , 0 , -2.1649469E-11 , -0.088436282 , 0 , 0 , 0 , 0 , 0 , 0.027527778 , 0 , 0 , 0 , 0 , 0 , 0 , 0.0030584608 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.22 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , -0.228 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.008 , 0 , 0 , 0 , 0 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.22 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , -0.228 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.008 , 0 , 0 , 0 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.14891977 , 0 , 0 , 0 , 0.0191806 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , -0.16687311 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0];
[0 , 0 , 0 , 0.47 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , -3.8154545 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.0191806 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.14769251 , 0 , -0.16564585 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0];
[0 , 0 , -2.216014E-13 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.00183613 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , -0.047103776 , 0 , 0 , 0 , 0 , 0 , 0 , -0.00057379064 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.47 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 3.3454545 , 0 , 0 , -3.8154545 , 0 , 0 , 0 , 0 , 0 , 0 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , -2.1642474E-11 , 0 , 0.10947169 , 0 , 0 , -0.0030414965 , 0 , 0 , 0 , 0 , -0.087822959 , 0 , 0 , 0 , 0 , 0 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.47 , 0 , 0 , 0 , 0 , 0 , 3.3454545 , 0 , -3.8154545 , 0 , 0 , 0 , 0 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.47 , 0 , 0 , 0 , 0 , 0 , 0 , 3.3454545 , -3.8154545 , 0 , 0 , 0 , 0];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.048846797 , -0.00057379064 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , -0.048825148 , 0 , 0 , -3.9594259E-14];
[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , -2.1650164E-11 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , -0.0030414965 , 0 , 0 , 0.10885837 , 0 , 0 , 0 , -0.087209635 , 0 , 0];
[0 , 0 , 0 , 0.003 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0.0021818182 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , -0.0051818182 , 0];
[0 , 0 , 0 , 0 , 0.0021818182 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , -1.0734E-5 , 0 , 0 , -0.0021818182]];

B = [[0];[0];[0];[0];[0];[0];[0];[0];[0];[0];[0];[0];[0];[0];[0];[0];[0];[0];[0];[0];[0];[0];[0];[0];[3.3454546];[0];[0];[0];[0];[0];[0];[0];[0];[0];[0];];

C = [[0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0]];

D = [[0]];


% A = [[5 , -6 , 2 ];
% [5 , -4 , 1];
% [0 , 6 , -3]];
% 
% B = [[1];[2];[3];];
% 
% C = [[0.5 , -1 , 0.5]];
% 
% D = [[0]];


size_A = size(A);

sys = ss(A, B, C, D);

% fprintf('\tСобственные числа: \n')

my_num = eig(A);

% fprintf('\tМатрицы управляемости U и наблюдаемости V:\n')
U = ctrb(A,B);
V = obsv(A,C);

% fprintf('\nРанги:\n')
% size(A)
% size(B)
% size(C)
% rank(U)
% rank(V)


% Приведение системы к минимальной реализации:
% M – матрица преобразования координат, sysmin – минимальная реализация системы sys
[sysmin, M] = minreal(sys)

Ar = M * A * inv(M);
Br = M * B;
Cr = C * inv(M);


% __________________________________________________________________________________


% W_nu = G_s_nu / D_s_nu
E = eye(size(Ar)); % Единичная матрица
sE_Ar = (s * E) - Ar;

Exp_x_nu = zeros(size_A(1),1,'double');
Exp_x_nu(size_A(1)) = 1;

% G_s_nu = vpa(expand(det([[sE_Ar , Exp_x_nu]; [-(s * Cr) , 0]])), 2) % matRezenbroga
% D_s_nu = vpa((expand(det(sE_Ar))), 2)

W_s_nu_new = vpa(simplify(expand((s * Cr * inv(sE_Ar) * Exp_x_nu))), 2) % Alternative


% __________________________________________________________________________________


% W_min = G_s_min / D_s_min
E = eye(size(sysmin.A)); % Единичная матрица
sE_A_min = (s * E) - sysmin.A;

% G_s_min = vpa(expand(det([[sE_A_min , sysmin.B]; [-sysmin.C , sysmin.D]])), 2) % matRezenbroga
% D_s_min = vpa(expand(det(sE_A_min)), 2)

W_s_min_new = vpa(simplify(expand((sysmin.C * inv(sE_A_min) * sysmin.B))), 2) % Alternative

% __________________________________________________________________________________


% U_nu = -(W_nu / W_min)
% U_nu = vpa((simplify(-1 * ((G_s_nu * D_s_min) / ((D_s_nu * G_s_min))))), 2) % vpa(-1 * (-((1.1*s^2 - 2.5*s + 4.4))/0.9994), 2) % vpa((simplify(-1 * ((G_s_nu * D_s_min) / ((D_s_nu * G_s_min))))), 2)

U_nu_new =  vpa((simplify(-1 * ((W_s_nu_new) / ((W_s_min_new))))), 2) % Alternative


K_nu = zeros(1,size_A(1),'double');
K_nu(size_A(1)) = subs(int(simplify(ilaplace(U_nu, s, t))), t, 1)


% __________________________________________________________________________________


U_c = vpa(K_nu * M, 2)








